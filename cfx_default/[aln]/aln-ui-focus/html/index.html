<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>ALN UI Focus Debug</title>
    <style>
      body { margin:0; font-family: Arial, sans-serif; background: rgba(0,0,0,0); }
      .box {
        position: absolute; top: 10%; left: 50%; transform: translateX(-50%);
        width: 520px; padding: 18px 18px 14px;
        background: rgba(20,20,24,0.92); color: #fff;
        border-radius: 12px; border: 1px solid rgba(255,255,255,0.08);
        box-shadow: 0 18px 50px rgba(0,0,0,0.35);
        display: none;
      }
      .title { font-size: 18px; margin-bottom: 10px; }
      .meta { font-size: 12px; opacity: 0.85; margin-bottom: 14px; }
      .hint { font-size: 13px; opacity: 0.9; }
      .btn {
        margin-top: 14px; padding: 10px 12px; border-radius: 10px;
        border: 1px solid rgba(255,255,255,0.14);
        background: rgba(255,255,255,0.08); color: #fff; cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div class="box" id="box">
      <div class="title">ALN UI Focus Debug</div>
      <div class="meta" id="meta">Waitingâ€¦</div>
      <div class="hint">Press <b>ESC</b> or <b>Backspace</b> to request close.</div>
      <button class="btn" id="btn">Close (simulate UI closing)</button>
    </div>

    <script>
      const box = document.getElementById('box');
      const meta = document.getElementById('meta');
      const btn  = document.getElementById('btn');

      let current = { uiId: null, token: null };

      window.addEventListener('message', (e) => {
        const d = e.data || {};
        if (d.type === 'aln_ui_open') {
          current.uiId = d.uiId;
          current.token = d.token;
          meta.textContent = `uiId=${d.uiId} token=${d.token}`;
          box.style.display = 'block';
        }
        if (d.type === 'aln_ui_close') {
          // focus manager is requesting close; UI should now close itself and release token on client side.
          meta.textContent = `Close requested for uiId=${d.uiId} token=${d.token}`;
        }
      });

      btn.addEventListener('click', async () => {
        // This simulates a UI that closes itself (fade out) then tells Lua to release.
        box.style.display = 'none';
        await fetch(`https://${GetParentResourceName()}/aln_ui_focus_close`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json; charset=UTF-8' },
          body: JSON.stringify({ uiId: current.uiId, token: current.token })
        });
      });
    </script>
  </body>
</html>
